const defaults={serverProcessing:{value:!1,type:"boolean"},maxDisplaySize:{value:10,type:"number"},dataSource:{value:void 0,type:"function"},minType:{value:1,type:"number"},overflow:{value:!1,type:"boolean"},maxHeight:{value:200,type:"number"}};class BootstrapAutoComplete{constructor(e,t){if(!e||"INPUT"!=e.nodeName)throw new Error("No element or input type was found.");if(this.config={},this.element=e,this.data=[],this.filteredData=[],this.menuIsShown=!1,this.setConfig(t),this.menu=this.buildSelectMenu(),null==this.config.dataSource)throw new Error("No dataSource was provided");this.config.serverProcessing||(this.data=[...this.config.dataSource()].map(e=>e.toString())),this.addInputEvents(),e.bootstrapAutoComplete=this}setConfig(e){Object.keys(defaults).forEach(t=>{e&&e.hasOwnProperty(t)&&(typeof e[t]==defaults[t].type?this.config[t]=e[t]:console.error(`${t} must be type ${defaults[t].type}. Used default values.`)),this.config.hasOwnProperty(t)||(this.config[t]=defaults[t].value)})}buildSelectMenu(){let e=window.getComputedStyle(this.element.parentElement,null),t=document.createElement("ul");return t.className="list-group position-absolute top-100 fade",t.style.width=`calc(100% - ${e.paddingLeft} - ${e.paddingRight}`,this.config.overflow&&(t.classList.add("overflow-auto"),t.style.maxHeight=`${this.config.maxHeight}px`),this.element.parentElement.append(t),t}addInputEvents(){var e=this;this.element.addEventListener("keydown",function(t){if(e.menuIsShown)switch(t.key){case"Enter":e.selectEntry(),t.preventDefault();break;case"ArrowUp":e.setActiveItem("previousElementSibling"),t.preventDefault();break;case"ArrowDown":e.setActiveItem("nextElementSibling"),t.preventDefault()}}),this.element.addEventListener("input",async function(){if(this.value.length<e.config.minType)return void e.hide();let t=this.value;if(!e.config.serverProcessing||(e.data=await e.config.dataSource(this.value,e.config.maxDisplaySize),this.value==t))if(e.filteredData=e.data.filter(e=>e.toLowerCase().includes(this.value.toLowerCase())),e.menu.innerHTML="",e.filteredData.length>0){var i=new RegExp(this.value,"gi");e.filteredData.slice(0,e.config.maxDisplaySize).forEach(t=>{e.menu.append(e.generateMenuItem(t,this.value,i))}),e.show()}else e.hide()}),this.element.addEventListener("focusout",function(t){e.hide()})}generateMenuItem(e,t,i){let s=document.createElement("li");s.className="list-group-item list-group-item-action px-3 py-1",s.dataset.value=e,s.innerHTML=e.replaceAll(i,"<strong>$&</strong>");var n=this;return s.addEventListener("mousedown",function(e){e.stopPropagation(),this.classList.add("active"),n.element.value=this.dataset.value,n.hide()}),s}setActiveItem(e){if(0==this.menu.querySelectorAll(".list-group-item").length)return;let t=this.menu.querySelector(".active"),i=this.menu.querySelector(`.list-group-item:${"nextElementSibling"==e?"first-child":"last-child"}`);if(t){t.classList.remove("active");let s=t[e];i=s||i}i.classList.add("active"),this.config.overflow&&i.scrollIntoView(!0)}selectEntry(){let e=this.menu.querySelector(".active");0!=this.menu.querySelectorAll(".list-group-item").length&&e&&(this.element.value=e.dataset.value,this.hide())}show(){this.menuIsShown=!0,this.menu.classList.add("show")}hide(){this.menuIsShown=!1,this.menu.classList.remove("show"),setTimeout(()=>{this.menu.innerHTML=""},100)}}